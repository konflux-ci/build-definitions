---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: sanity-optional-label-check
spec:
  params:
    - name: sourceImage
      description: the fully qualified image name
  workspaces:
    - name: workspace

  steps:
    - name: optional-label-check
      image: quay.io/redhat-appstudio/hacbs-test:stable
      workingDir: $(workspaces.workspace.path)/hacbs/$(context.task.name)
      script: |
        skopeo inspect --no-tags docker://$(inputs.params.sourceImage) > optional_label_image_inspect.json
        /usr/bin/conftest test optional_label_image_inspect.json --policy /project/image/optional-labels.rego --output=json
