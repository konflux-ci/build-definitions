---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: sanity-optional-label-check
spec:
  params:
    - name: sourceImage
      description: the fully qualified image name
      default: quay.io/cvpops/test-index:v4.10

  steps:
    - name: inspect-image
      image: quay.io/redhat-appstudio/hacbs-test:latest
      script: "skopeo inspect docker://$(inputs.params.sourceImage) > /tekton/home/image_inspect.json"

    - name: optional-labels-check
      image: quay.io/redhat-appstudio/hacbs-test:latest
      command:
        - /usr/bin/conftest
      args:
        - "test"
        - "/tekton/home/image_inspect.json"
        - "--policy"
        - "/project/image/policy/optional-labels.rego"
        - "--output=json"
