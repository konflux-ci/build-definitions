---
base: ../../prefetch-dependencies/0.2/prefetch-dependencies.yaml
add:
  - use-source
  - create-source
  - create-prefetch
additionalSteps:
  - at: 0
    name: skip-ta
    image: registry.access.redhat.com/ubi9/ubi-minimal:9.6-1758184547@sha256:7c5495d5fad59aaee12abc3cbbd2b283818ee1e814b00dbc7f25bf2d14fa4f0c
    env:
    - name: INPUT
      value: $(params.input)
    - name: SOURCE_ARTIFACT
      value: $(params.SOURCE_ARTIFACT)
    script: |
      if [ -z "${INPUT}" ]; then
        mkdir -p /var/workdir/source
        mkdir -p /var/workdir/cachi2
        echo "true" > /var/workdir/source/.skip-trusted-artifacts
        echo "true" > /var/workdir/cachi2/.skip-trusted-artifacts
        echo -n "${SOURCE_ARTIFACT}" > $(results.SOURCE_ARTIFACT.path)
        echo -n "" > $(results.CACHI2_ARTIFACT.path)
      fi
description: |-
    Task that uses Hermeto to prefetch build dependencies. The fetched dependencies and the
    application source code are stored as a trusted artifact in the provided OCI repository.
    For additional info on Hermeto, see docs at
    https://hermetoproject.github.io/hermeto/#basic-usage

    ## Configuration

    Config file must be passed as a YAML string. For all available config options please check
    [available configuration parameters] page.

    Example of setting timeouts:

    ```yaml
    params:
      - name: config-file-content
        value: |
          ---
          requests_timeout: 300
          subprocess_timeout: 3600
    ```

    [available configuration parameters]: https://hermetoproject.github.io/hermeto/#available-configuration-parameters
preferStepTemplate: true
removeWorkspaces:
  - source
replacements:
  workspaces.source.path: /var/workdir
