---
base: ../../prefetch-dependencies/0.2/prefetch-dependencies.yaml
add:
  - use-source
  - create-source
  - create-prefetch
additionalSteps:
  - at: 0
    name: skip-ta
    image: registry.access.redhat.com/ubi9/ubi-minimal:9.7-1770267347@sha256:759f5f42d9d6ce2a705e290b7fc549e2d2cd39312c4fa345f93c02e4abb8da95
    env:
    - name: INPUT
      value: $(params.input)
    - name: SOURCE_ARTIFACT
      value: $(params.SOURCE_ARTIFACT)
    script: |
      if [ -z "${INPUT}" ]; then
        mkdir -p /var/workdir/source
        mkdir -p /var/workdir/cachi2
        echo "true" > /var/workdir/source/.skip-trusted-artifacts
        echo "true" > /var/workdir/cachi2/.skip-trusted-artifacts
        echo -n "${SOURCE_ARTIFACT}" > $(results.SOURCE_ARTIFACT.path)
        echo -n "" > $(results.CACHI2_ARTIFACT.path)
      fi
description: Task that prefetches project dependencies for hermetic build.
preferStepTemplate: true
removeWorkspaces:
  - source
replacements:
  workspaces.source.path: /var/workdir
